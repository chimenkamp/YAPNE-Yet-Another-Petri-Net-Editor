<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>YAPNE - Yet Another Petri Net Editor - Accessible Petri Net Editor</title>
    <meta name="description" content="WCAG 2.0 AA compliant Petri Net Editor with full keyboard navigation and screen reader support">
    
    <!-- Cross-Origin Isolation Service Worker -->
    <script src="/YAPNE-Yet-Another-Petri-Net-Editor/coi-serviceworker.js"></script>
    
    <link rel="stylesheet" href="styles/layout.css">
    <link rel="stylesheet" href="styles/event-log.css">
    <link rel="stylesheet" href="styles/dpn-styles.css">
    <link rel="stylesheet" href="styles/pnml-importer.css">
    <link rel="stylesheet" href="styles/accessibility.css">

    <!-- Polyfills for Z3 and Node.js compatibility -->
    <script>
      // Provide global polyfills for Z3 compatibility
      window.global = window;
      window.process = window.process || { 
        env: {}, 
        version: '', 
        nextTick: (fn) => setTimeout(fn, 0),
        platform: 'browser',
        browser: true
      };
      
      // Create a simple require() shim for CommonJS compatibility
      if (typeof window.require === 'undefined') {
        const moduleCache = {};
        
        window.require = function(moduleId) {
          // Return cached module if it exists
          if (moduleCache[moduleId]) {
            return moduleCache[moduleId].exports;
          }
          
          // Create a new module object
          const module = {
            exports: {},
            id: moduleId,
            loaded: false
          };
          
          // Cache the module
          moduleCache[moduleId] = module;
          
          // Common Node.js built-in modules
          const builtins = {
            'util': window.util || {},
            'buffer': window.buffer || { Buffer: window.Buffer || {} },
            'process': window.process,
            'path': {
              join: (...args) => args.join('/'),
              resolve: (...args) => args.join('/'),
              dirname: (p) => p.split('/').slice(0, -1).join('/'),
              basename: (p) => p.split('/').pop(),
              extname: (p) => {
                const base = p.split('/').pop();
                const i = base.lastIndexOf('.');
                return i > 0 ? base.slice(i) : '';
              }
            },
            'fs': {},
            'crypto': window.crypto || {},
            'stream': {},
            'events': {}
          };
          
          // Return built-in if available
          if (builtins[moduleId]) {
            module.exports = builtins[moduleId];
            module.loaded = true;
            return module.exports;
          }
          
          // Return empty object for unknown modules
          module.loaded = true;
          return module.exports;
        };
        
        window.require.cache = moduleCache;
        window.require.resolve = (moduleId) => moduleId;
        window.require.main = {
          filename: window.location.href,
          loaded: true
        };
      }
      
      // Module exports compatibility
      window.module = window.module || { exports: {} };
      window.exports = window.exports || {};
    </script>

    <style>
        /* Additional styles for the ghost element feature */
        .info-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border: 1px solid #81c784;
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .info-section h4 {
            margin: 0 0 8px 0;
            color: #2e7d32;
            font-size: 14px;
            font-weight: 600;
        }
        
        .info-section p {
            margin: 0;
            font-size: 12px;
            line-height: 1.4;
            color: #424242;
        }
        
        .info-section kbd {
            background-color: #ffffff;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 1px 1px rgba(0,0,0,0.2);
            color: #333;
            display: inline-block;
            font-family: 'Courier New', Courier, monospace;
            font-size: 11px;
            font-weight: bold;
            line-height: 1;
            padding: 2px 4px;
            white-space: nowrap;
        }

        /* Enhanced cursor states */
        .canvas-container canvas.ghost-mode {
            cursor: crosshair !important;
        }

        /* Updated pan instructions to include ghost feature */
        .pan-instructions {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            position: absolute;
            z-index: 1000;
            pointer-events: none;
            white-space: nowrap;
        }

        .pan-instructions.extended {
            white-space: normal;
            max-width: 250px;
        }

        /* Ghost feature hint overlay */
        .ghost-hint {
            position: absolute;
            top: 80px;
            right: 10px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            z-index: 1001;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 200px;
        }

        .ghost-hint.show {
            opacity: 1;
        }

        /* Enhanced toolbar tooltips */
        .vertical-toolbar button {
            position: relative;
        }

        .vertical-toolbar button:hover::after {
            content: attr(title);
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            margin-left: 8px;
        }

/* Nord Theme Help Dialog Styles */
.help-dialog-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(46, 52, 64, 0.6);
    z-index: 10000;
    backdrop-filter: blur(3px);
}

.help-dialog {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #ECEFF4;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(46, 52, 64, 0.4);
    max-width: 600px;
    max-height: 80vh;
    width: 90%;
    overflow: hidden;
}

.help-dialog-header {
    background: linear-gradient(135deg, #88C0D0, #81A1C1);
    color: #ECEFF4;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.help-dialog-header h2 {
    margin: 0;
    font-size: 24px;
    font-weight: 600;
}

.help-dialog-close {
    background: none;
    border: none;
    color: #ECEFF4;
    font-size: 24px;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s;
}

.help-dialog-close:hover {
    background-color: rgba(236, 239, 244, 0.2);
}

.help-dialog-content {
    padding: 20px;
    overflow-y: auto;
    max-height: calc(80vh - 80px);
}

.help-section {
    margin-bottom: 25px;
}

.help-section h3 {
    color: #5E81AC;
    font-size: 18px;
    margin-bottom: 10px;
    border-bottom: 2px solid #D8DEE9;
    padding-bottom: 5px;
}

.help-controls-grid {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 10px 15px;
    margin-bottom: 15px;
}

.help-key {
    background-color: #D8DEE9;
    border: 1px solid #BFC7D5;
    border-radius: 4px;
    padding: 4px 8px;
    font-family: 'Courier New', Courier, monospace;
    font-size: 12px;
    font-weight: bold;
    color: #2E3440;
    min-width: 60px;
    text-align: center;
    box-shadow: 0 1px 2px rgba(46, 52, 64, 0.1);
}

.help-description {
    color: #434C5E;
    line-height: 1.4;
}

.help-tip {
    background: #E5E9F0;
    border-left: 4px solid #8FBCBB;
    padding: 10px 15px;
    margin: 15px 0;
    border-radius: 0 6px 6px 0;
    color:#2E3440;
}

.help-tip-icon {
    color: #88C0D0;
    font-weight: bold;
    margin-right: 5px;
}

.help-button {
    background: #81A1C1;
    color: #ECEFF4;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: background-color 0.2s;
    margin-top: 10px;
}

.help-button:hover {
    background: #5E81AC;
}
    </style>
</head> 
<body>
    <header>
        <div class="container">
            <h1 class="header-title">YAPNE - Yet Another Petri Net Editor</h1>
        </div>
    </header>

    <div class="container">
        <div class="editor-container">
            <div class="canvas-container">
                <div class="vertical-toolbar">
                    <div class="toolbar-group vertical">
                        <button id="btn-select" class="active" 
                                title="Select tool - Hold Shift while selected element to create connected elements"
                                aria-label="Select tool"
                                data-keyboard-hint="Alt+S">‚úì</button>
                        <button id="btn-add-place" 
                                title="Add place"
                                aria-label="Add place to canvas"
                                data-keyboard-hint="Alt+P">‚óã</button>
                        <button id="btn-add-transition" 
                                title="Add transition"
                                aria-label="Add transition to canvas"
                                data-keyboard-hint="Alt+T">‚ñ°</button>
                        <button id="btn-add-arc" 
                                title="Add arc - Hotkey: Space"
                                aria-label="Add arc between elements"
                                data-keyboard-hint="Alt+A / Space">‚Üí</button>
                        <hr>
                        <button id="btn-delete" class="danger" 
                                title="Delete selected element"
                                aria-label="Delete selected element"
                                data-keyboard-hint="Delete">üóëÔ∏è</button>
                        <button id="btn-clear" class="danger" 
                                title="Clear canvas"
                                aria-label="Clear entire canvas">üßπ</button>
                        <hr>
                        <button id="btn-auto-layout" class="blue" 
                                title="Auto-Layout"
                                aria-label="Automatically arrange elements">ü™Ñ</button>
                        <button id="btn-grid" 
                                title="Toggle snap to grid"
                                aria-label="Toggle snap to grid">üìè</button>
                    </div>
                </div>
                
                <!-- New Zoom Controls on Canvas -->
                <div class="zoom-controls" role="toolbar" aria-label="Zoom and view controls">
                    <button id="btn-zoom-in" 
                            title="Zoom In"
                            aria-label="Zoom in"
                            data-keyboard-hint="Ctrl/Cmd +">+</button>
                    <span id="zoom-display" 
                          role="status" 
                          aria-label="Current zoom level"
                          aria-live="polite">100%</span>
                    <button id="btn-zoom-out" 
                            title="Zoom Out"
                            aria-label="Zoom out"
                            data-keyboard-hint="Ctrl/Cmd -">-</button>
                    <button id="btn-reset-view" 
                            title="Reset View"
                            aria-label="Reset view to default"
                            data-keyboard-hint="Ctrl/Cmd 0">‚Ü∫</button>
                    <button id="btn-fullscreen" 
                            title="Toggle Full Screen"
                            aria-label="Toggle fullscreen mode">‚õ∂</button>
                    <button id="btn-fit-to-canvas" 
                            title="Fit to Canvas"
                            aria-label="Fit network to canvas">‚ä°</button>
                </div>
                
                <!-- Pan instructions overlay - will be updated with JS -->
                <div class="pan-instructions" id="pan-instructions">
                    <span>Pan: Middle mouse button or Space+drag</span>
                </div>

                <!-- Ghost feature hint overlay -->
                <div class="ghost-hint" id="ghost-hint">
                    üí° <strong>Ghost Mode Active!</strong><br>
                    Move mouse to position element, click to place
                </div>
                
                <canvas id="petri-canvas" class="resizable-content"></canvas>
            </div>

            <!-- BEGIN REDESIGNED SIDEBAR -->
            <div class="sidebar">
                <!-- Tab Navigation -->
                <div class="sidebar-tabs">
                    <button class="sidebar-tab active" data-tab="model">Model</button>
                    <button class="sidebar-tab" data-tab="simulation">Simulation</button>
                    <button class="sidebar-tab" data-tab="file">File</button>
                    <button class="sidebar-tab" data-tab="help">Help</button>
                </div>
                
                <!-- Tab Content -->
                <div class="sidebar-content">
                    <!-- Model Tab -->
                    <div class="sidebar-pane active" data-tab="model">
                        <!-- Properties Section -->
                        <div id="properties-section" class="sidebar-section">
                            <div class="section-header">
                                <div class="section-title">
                                    <span class="section-icon">‚öôÔ∏è</span>
                                    <h3>Properties</h3>
                                </div>
                                <button class="section-toggle">‚ñº</button>
                            </div>
                            <div class="section-content" id="properties-content">
                                <p>No element selected.</p>
                            </div>
                        </div>
                        
                        <!-- Data Variables Section -->
                        <div id="data-variables-section" class="sidebar-section">
                            <div class="section-header">
                                <div class="section-title">
                                    <span class="section-icon">üî¢</span>
                                    <h3>Data Variables</h3>
                                </div>
                                <button class="section-toggle">‚ñº</button>
                            </div>
                            <div class="section-content" id="data-variables-content-conatiner"> 

                            </div>
                        </div>
                    </div>
                    
                    <!-- Simulation Tab -->
                    <div class="sidebar-pane" data-tab="simulation">
                        <!-- Simulation Controls Section -->
                        <div id="simulation-controls-section" class="sidebar-section">
                            <div class="section-header">
                                <div class="section-title">
                                    <span class="section-icon">‚ñ∂Ô∏è</span>
                                    <h3>Simulation</h3>
                                </div>
                                <button class="section-toggle">‚ñº</button>
                            </div>
                            <div class="section-content">
                                <div class="button-group">
                                    <button id="btn-step" class="success" 
                                            title="Fire a single transition"
                                            aria-label="Execute one simulation step"
                                            data-keyboard-hint="Ctrl/Cmd R">Step</button>
                                    <button id="btn-auto-run" class="success" 
                                            title="Auto-fire transitions"
                                            aria-label="Start automatic simulation">Auto Run</button>
                                    <button id="btn-reset" 
                                            title="Reset simulation to initial state"
                                            aria-label="Reset simulation to initial state">Reset</button>
                                </div>
                            </div>
                        </div>                        <!-- Token Marking Section -->
                        <div id="tokens-section" class="sidebar-section">
                            <div class="section-header">
                                <div class="section-title">
                                    <span class="section-icon">‚ö´</span>
                                    <h3>Token Marking</h3>
                                </div>
                                <button class="section-toggle">‚ñº</button>
                            </div>
                            <div class="section-content tokens-display" id="tokens-display">
                                <!-- Will be filled dynamically -->
                                <p>No places in the Petri net.</p>
                            </div>
                        </div>
                        <div id="final-marking-section" class="sidebar-section">
                        <div class="section-header">
                            <div class="section-title">
                            <span class="section-icon">üéØ</span>
                            <h3>Final Markings</h3>
                            </div>
                            <button class="section-toggle">‚ñº</button>
                        </div>
                        <div class="section-content" id="final-marking-content">
                            <p>No final markings defined.</p>
                        </div>
                        </div>
                        <!-- Data Values Section -->
                        <div id="data-values-section" class="sidebar-section">
                            <div class="section-header">
                                <div class="section-title">
                                    <span class="section-icon">üìä</span>
                                    <h3>Data Values</h3>
                                </div>
                                <button class="section-toggle">‚ñº</button>
                            </div>
                            <div class="section-content" id="data-values-content">
                                <!-- Will be filled dynamically -->
                                <p>No data variables defined.</p>
                            </div>
                        </div>
                        
                        <!-- Variable History Section -->
                        <div id="variable-history-section" class="sidebar-section">
                            <div class="section-header">
                                <div class="section-title">
                                    <span class="section-icon">üìà</span>
                                    <h3>Variable History</h3>
                                </div>
                                <button class="section-toggle">‚ñº</button>
                            </div>
                            <div class="section-content">
                                <div class="section-content" id="variable-history-content">
                                    <p>History tracking is disabled.</p>
                                </div>
                                <div class="section-actions">
                                    <button id="btn-toggle-history">Start Tracking</button>
                                    <button id="btn-clear-history">Clear</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- File Tab -->
                    <div class="sidebar-pane" data-tab="file">
                        <!-- Example Section -->
                        <div id="templates-section" class="sidebar-section">
                            <div class="section-header">
                                <div class="section-title">
                                    <span class="section-icon">üìã</span>
                                    <h3>Examples</h3>
                                </div>
                                <button class="section-toggle">‚ñº</button>
                            </div>
                            <div class="section-content">
                                <select id="template-select">
                                    <option value="">Select an example...</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- File Operations Section -->
                        <div id="file-operations-section" class="sidebar-section">
                            <div class="section-header">
                                <div class="section-title">
                                    <span class="section-icon">üìÅ</span>
                                    <h3>File Operations</h3>
                                </div>
                                <button class="section-toggle">‚ñº</button>
                            </div>
                            <div class="section-content">
                                <div class="button-group">
                                    <button id="btn-load">Load (JSON)</button>
                                    <button id="btn-save">Save (JSON)</button>
                                    <input type="file" id="file-input" class="hidden" accept=".json">
                                </div>
                                <div class="button-group" id="pnml-button-group">
                                    <button id="btn-export-pnml">Save (PNML)</button>
                                </div>
                            </div>
                        </div>
                        <div id="file-generation" class="sidebar-section">
                            <div class="section-header">
                                <div class="section-title">
                                    <span class="section-icon">‚öôÔ∏è</span>
                                    <h3>Generation</h3>
                                </div>
                                <button class="section-toggle">‚ñº</button>
                            </div>
                            <div class="section-content">
                               <button id="btn-event-log" style="width: 100%;">Generate Event Log</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Help Tab -->
                    <div class="sidebar-pane" data-tab="help">
                        <!-- Quick Help Button -->
                        <div id="quick-help-section" class="sidebar-section">
                            <div class="section-header">
                                <div class="section-title">
                                    <span class="section-icon">‚ùì</span>
                                    <h3>Quick Help</h3>
                                </div>
                                <button class="section-toggle">‚ñº</button>
                            </div>
                            <div class="section-content">
                                <button id="btn-open-help" class="help-button" style="width: 100%;">üìñ Open Guide</button>
                            </div>
                        </div>
                        
                        <!-- Navigation Help Section -->
                        <div id="navigation-help-section" class="sidebar-section">
                            <div class="section-header">
                                <div class="section-title">
                                    <span class="section-icon">üß≠</span>
                                    <h3>Navigation</h3>
                                </div>
                                <button class="section-toggle">‚ñº</button>
                            </div>
                            <div class="section-content">
                                <ul class="help-list" id="navigation-help-list">
                                    <li><strong>Pan:</strong> Middle mouse button or Space+drag</li>
                                    <li><strong>Zoom:</strong> Mouse wheel or use zoom controls</li>
                                    <li><strong>Reset View:</strong> Click ‚Ü∫ button to reset pan/zoom</li>
                                    <li><strong>Full Screen:</strong> Click ‚õ∂ button to toggle full screen mode</li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Tools Help Section -->
                        <div id="tools-help-section" class="sidebar-section">
                            <div class="section-header">
                                <div class="section-title">
                                    <span class="section-icon">üõ†Ô∏è</span>
                                    <h3>Editor Tools</h3>
                                </div>
                                <button class="section-toggle">‚ñº</button>
                            </div>
                            <div class="section-content">
                                <ul class="help-list">
                                    <li><strong>Select:</strong> Click the ‚úì button to select and move elements</li>
                                    <li><strong>Add Place:</strong> Click the ‚óã button to add places</li>
                                    <li><strong>Add Transition:</strong> Click the ‚ñ° button to add transitions</li>
                                    <li><strong>Add Arc:</strong> Click the ‚Üí button or press <kbd>C</kbd> to connect elements</li>
                                    <li><strong>Delete:</strong> Select an element and click üóëÔ∏è to delete</li>
                                    <li><strong>Auto Layout:</strong> Click ü™Ñ to automatically arrange elements</li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- About Section -->
                        <div id="about-section" class="sidebar-section">
                            <div class="section-header">
                                <div class="section-title">
                                    <span class="section-icon">‚ÑπÔ∏è</span>
                                    <h3>About</h3>
                                </div>
                                <button class="section-toggle">‚ñº</button>
                            </div>
                            <div class="section-content">
                                <p>YAPNE - Yet Another Petri Net Editor</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Dialog Overlay -->
    <div id="help-dialog-overlay" class="help-dialog-overlay">
        <div class="help-dialog">
            <div class="help-dialog-header">
                <h2>üìñ Controls Guide</h2>
                <button id="help-dialog-close" class="help-dialog-close">√ó</button>
            </div>
            <div class="help-dialog-content">
                <div class="help-section">
                    <h3>üîß Editor Tools</h3>
                    <div class="help-controls-grid">
                        <span class="help-key">Click ‚úì</span>
                        <span class="help-description">Select and move elements</span>
                        <span class="help-key">Click ‚óã</span>
                        <span class="help-description">Add new places</span>
                        <span class="help-key">Click ‚ñ°</span>
                        <span class="help-description">Add new transitions</span>
                        <span class="help-key">Click ‚Üí</span>
                        <span class="help-description">Connect elements with arcs</span>
                        <span class="help-key">Click üóëÔ∏è</span>
                        <span class="help-description">Delete selected element</span>
                        <span class="help-key">Click ü™Ñ</span>
                        <span class="help-description">Auto-arrange all elements</span>
                    </div>
                </div>

                <div class="help-section">
                    <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
                    <div class="help-controls-grid">
                        <span class="help-key">C</span>
                        <span class="help-description">Hold to enter connection mode, release to return to select mode</span>
                        <span class="help-key">Shift + Move</span>
                        <span class="help-description">Ghost mode: Create connected elements quickly</span>
                        <span class="help-key">F / Ctrl+F</span>
                        <span class="help-description">Toggle fullscreen mode</span>
                        <span class="help-key">Escape</span>
                        <span class="help-description">Exit fullscreen mode</span>
                    </div>
                </div>

                <div class="help-section">
                    <h3>üñ±Ô∏è Mouse Controls</h3>
                    <div class="help-controls-grid">
                        <span class="help-key">Left Click</span>
                        <span class="help-description">Select, place, or connect elements</span>
                        <span class="help-key">Left Drag</span>
                        <span class="help-description">Move selected elements</span>
                        <span class="help-key">Middle Click</span>
                        <span class="help-description">Pan the canvas</span>
                        <span class="help-key">Scroll Wheel</span>
                        <span class="help-description">Zoom in and out</span>
                        <span class="help-key">Alt/Cmd + Drag</span>
                        <span class="help-description">Pan the canvas</span>
                    </div>
                </div>

                <div class="help-section">
                    <h3>‚ö° Advanced Features</h3>
                    <div class="help-tip">
                        <span class="help-tip-icon">üí°</span>
                        <strong>Ghost Mode:</strong> Select any place or transition, hold <kbd>Shift</kbd>, and move your mouse to quickly create connected elements. Click to place the new element with an automatic connection.
                    </div>
                    <div class="help-tip">
                        <span class="help-tip-icon">üîó</span>
                        <strong>Quick Connect:</strong> Press <kbd>C</kbd> to instantly switch to connection mode. Release <kbd>C</kbd> to return to your previous tool.
                    </div>
                    <div class="help-tip">
                        <span class="help-tip-icon">üìè</span>
                        <strong>Grid Snapping:</strong> Use the grid button (üìè) to enable snap-to-grid for precise element placement.
                    </div>
                </div>

                <div class="help-section">
                    <h3>üéØ Simulation Controls</h3>
                    <div class="help-controls-grid">
                        <span class="help-key">Step</span>
                        <span class="help-description">Fire one enabled transition and capture initial state if first simulation step</span>
                        <span class="help-key">Auto Run</span>
                        <span class="help-description">Continuously fire transitions automatically and capture initial state if first run</span>
                        <span class="help-key">Reset</span>
                        <span class="help-description">Reset simulation to the captured initial state (tokens and data variables)</span>
                        <span class="help-key">Fire Button</span>
                        <span class="help-description">Fire a specific transition (appears when transition is selected)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
        
        </div>
    </footer>

    
    <script type="module" src="/src/extensions/z3-expression-evaluation.js"></script>

    <script type="module" src="src/petri-net-simulator.js"></script>
    <script type="module" src="src/dpn_to_smt.js"></script>
    <script type="module" src="src/extensions/dpn-expression-validation.js"></script>
    <script type="module" src="src/extensions/dpn-model.js"></script>
    <script type="module" src="src/extensions/dpn-api.js"></script>
    <script type="module" src="src/extensions/dpn-renderer.js"></script>
    <script type="module" src="src/extensions/dpn-ui.js"></script>
    <script type="module" src="src/extensions/dpn-integration.js"></script>

    <script type="module" src="src/extensions/dpn-suvorov-lomazova-ui.js"></script>



    <script type="module" src="petri-net-app.js"></script>

    <script>
        document.debugObj = async function debugObj(target) {
            const maxDepth = 2;

            /**
             * Recursively formats any value (including Promises) to a string.
             *
             * @param {*} value     The value to format.
             * @param {number} depth  Current recursion depth.
             * @return {Promise<string>}  Resolves to the formatted string.
             */
            async function formatValue(value, depth = 0) {
                if (value instanceof Promise) {
                    try {
                        const resolved = await value;
                        return `Promise ‚Üí ${await formatValue(resolved, depth)}`;
                    } catch (err) {
                        return `Promise rejected ‚Üí ${err}`;
                    }
                }
                if (depth > maxDepth) {
                    return Array.isArray(value) ? '[Array]' : '[Object]';
                }
                const type = typeof value;
                if (value === null || ['undefined', 'boolean', 'number', 'string'].includes(type)) {
                    return JSON.stringify(value);
                }
                if (type === 'function') {
                    const sig = value.toString().split('\n')[0];
                    return `[Function ${sig.length > 50 ? sig.slice(0, 47) + '...' : sig}]`;
                }
                if (Array.isArray(value)) {
                    const items = await Promise.all(
                        value.map(v => formatValue(v, depth + 1))
                    );
                    return `[${items.join(', ')}]`;
                }
                if (type === 'object') {
                    const entries = await Promise.all(
                        Object.getOwnPropertyNames(value).map(async key => {
                            let val;
                            try {
                                val = value[key];
                            } catch (err) {
                                return `${key}: [Error accessing property]`;
                            }
                            const formatted = await formatValue(val, depth + 1);
                            return `${key}: ${formatted}`;
                        })
                    );
                    return `{ ${entries.join(', ')} }`;
                }
                return String(value);
            }

            console.group(`debugObj dump of ${target && target.constructor ? target.constructor.name : typeof target}`);
            const props = Object.getOwnPropertyNames(target).sort();
            for (const key of props) {
                let rawValue;
                try {
                    rawValue = target[key];
                } catch (err) {
                    rawValue = `[Error accessing property: ${err}]`;
                }
                const formatted = await formatValue(rawValue, 0);
                console.log(`${key} (${typeof rawValue}):`, formatted);
            }
            console.groupEnd();
        };
    </script>


    <script>
        if (window.crossOriginIsolated) {
            console.log("%c‚úÖ This page is cross-origin isolated.", "color: green; font-weight: bold;");
        } else {
            console.warn("%c‚ùå This page is not cross-origin isolated. Some features may not work as expected.", "color: red; font-weight: bold;");
        }
    </script>


    <script type="module" src="app.js"></script>

    <script type="module" src="src/event-log-integration.js"></script>
    <script type="module" src="src/event-log-generator.js"></script>
    
    <script type="module" src="src/extensions/variable-tracking.js"></script>
    <script type="module" src="src/extensions/pnml-importer.js"></script>
    
    <!-- Accessibility Features -->
    <script type="module">
        import { initializeAccessibility } from './src/accessibility/accessibility-integration.js';
        
        // Wait for app to be ready
        window.addEventListener('load', () => {
            // Give the app time to initialize
            setTimeout(() => {
                if (window.petriApp) {
                    initializeAccessibility(window.petriApp);
                    console.log('‚úÖ WCAG 2.0 Accessibility Features Enabled');
                }
            }, 500);
        });
    </script>

</body>
</html>